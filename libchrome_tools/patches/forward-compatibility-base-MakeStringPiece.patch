From f9cbaa6b6fa274bab342f89d07f7f591f8c32dba Mon Sep 17 00:00:00 2001
From: hscham <hscham@chromium.org>
Date: Mon, 8 Mar 2021 19:20:30 +0900
Subject: [PATCH 2/2] Add base::MakeStringPiece

To replace deprecated base::BasicStringPiece(Iter, Iter)

Change-Id: Ieece4fbca31e8a14c1ed905e5aef2356ab4f340d
---
 base/strings/string_util.h | 25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)

diff --git a/base/strings/string_util.h b/base/strings/string_util.h
index 165ec37c26..d682789ea4 100644
--- a/base/strings/string_util.h
+++ b/base/strings/string_util.h
@@ -92,6 +92,31 @@ CharT ToLowerASCII(CharT c) {
   return (c >= 'A' && c <= 'Z') ? (c + ('a' - 'A')) : c;
 }
 
+// Simplified implementation of C++20's std::basic_string_view(It, End).
+// Reference: https://wg21.link/string.view.cons
+template <typename StringT, typename Iter>
+constexpr BasicStringPiece<StringT> MakeBasicStringPiece(Iter begin, Iter end) {
+  DCHECK_GE(end - begin, 0);
+  return {base::to_address(begin), static_cast<size_t>(end - begin)};
+}
+
+// Explicit instantiations of MakeBasicStringPiece for the BasicStringPiece
+// aliases defined in base/strings/string_piece_forward.h
+template <typename Iter>
+constexpr StringPiece MakeStringPiece(Iter begin, Iter end) {
+  return MakeBasicStringPiece<std::string>(begin, end);
+}
+
+template <typename Iter>
+constexpr StringPiece16 MakeStringPiece16(Iter begin, Iter end) {
+  return MakeBasicStringPiece<string16>(begin, end);
+}
+
+template <typename Iter>
+constexpr WStringPiece MakeWStringPiece(Iter begin, Iter end) {
+  return MakeBasicStringPiece<std::wstring>(begin, end);
+}
+
 // ASCII-specific toupper.  The standard library's toupper is locale sensitive,
 // so we don't want to use it here.
 template <typename CharT,
-- 
2.30.1.766.gb4fecdf3b7-goog

